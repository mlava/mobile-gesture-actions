class e{constructor(t,o){this.element=t,this.touch1=null,this.touch2=null,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.touchMove1=null,this.touchMove2=null,this.touchMoveX=null,this.touchMoveY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapTimer=null,this.doubleTapWaiting=!1,this.thresholdX=0,this.thresholdY=0,this.disregardVelocityThresholdX=0,this.disregardVelocityThresholdY=0,this.swipingHorizontal=!1,this.swipingVertical=!1,this.swipingDirection=null,this.swipedHorizontal=!1,this.swipedVertical=!1,this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[],pinch:[],pinchend:[],rotate:[],rotateend:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.opts=Object.assign({},e.defaults,o),this.element.addEventListener("touchstart",this._onTouchStart,i),this.element.addEventListener("touchmove",this._onTouchMove,i),this.element.addEventListener("touchend",this._onTouchEnd,i),this.opts.mouseSupport&&!("ontouchstart"in window)&&(this.element.addEventListener("mousedown",this._onTouchStart,i),document.addEventListener("mousemove",this._onTouchMove,i),document.addEventListener("mouseup",this._onTouchEnd,i))}destroy(){var e,t;this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout(null!==(e=this.longPressTimer)&&void 0!==e?e:void 0),clearTimeout(null!==(t=this.doubleTapTimer)&&void 0!==t?t:void 0)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){const o=this.handlers[e].indexOf(t);-1!==o&&this.handlers[e].splice(o,1)}}fire(e,t){for(let o=0;o<this.handlers[e].length;o++)this.handlers[e][o](t)}onTouchStart(e){var t,o,i,n,s,h,l,a,r,d,u,c,g,p,v,w,y,m,f,T,b,S,A,M,K,P;let k=!1;if("mousedown"!==e.type){if(this.touch1||(this.touch1=e.changedTouches[0],k=!0),(k&&e.changedTouches.length>1||!k)&&!this.touch2)return this.touch2=[...e.changedTouches].find(e=>{var t;return e.identifier!==(null===(t=this.touch1)||void 0===t?void 0:t.identifier)})||null,this.originalDistance=Math.sqrt(Math.pow((null!==(o=null===(t=this.touch2)||void 0===t?void 0:t.screenX)&&void 0!==o?o:0)-(null!==(h=null!==(n=null===(i=this.touchMove1)||void 0===i?void 0:i.screenX)&&void 0!==n?n:null===(s=this.touch1)||void 0===s?void 0:s.screenX)&&void 0!==h?h:0),2)+Math.pow((null!==(a=null===(l=this.touch2)||void 0===l?void 0:l.screenY)&&void 0!==a?a:0)-(null!==(c=null!==(d=null===(r=this.touchMove1)||void 0===r?void 0:r.screenY)&&void 0!==d?d:null===(u=this.touch1)||void 0===u?void 0:u.screenY)&&void 0!==c?c:0),2)),void(this.originalAngle=Math.atan2((null!==(p=null===(g=this.touch2)||void 0===g?void 0:g.screenY)&&void 0!==p?p:0)-(null!==(m=null!==(w=null===(v=this.touchMove1)||void 0===v?void 0:v.screenY)&&void 0!==w?w:null===(y=this.touch1)||void 0===y?void 0:y.screenY)&&void 0!==m?m:0),(null!==(T=null===(f=this.touch2)||void 0===f?void 0:f.screenX)&&void 0!==T?T:0)-(null!==(M=null!==(S=null===(b=this.touchMove1)||void 0===b?void 0:b.screenX)&&void 0!==S?S:null===(A=this.touch1)||void 0===A?void 0:A.screenX)&&void 0!==M?M:0))/(Math.PI/180));if(!k)return}(k||"mousedown"===e.type)&&(this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX="mousedown"===e.type?e.screenX:(null===(K=this.touch1)||void 0===K?void 0:K.screenX)||0,this.touchStartY="mousedown"===e.type?e.screenY:(null===(P=this.touch1)||void 0===P?void 0:P.screenY)||0,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.swipingDirection=null,this.longPressTimer=setTimeout(()=>this.fire("longpress",e),this.opts.longPressTime),this.scale=1,this.rotation=0,this.fire("panstart",e))}onTouchMove(e){var t,o,i,n,s,h,l,a,r,d,u,c,g;if("mousemove"===e.type&&(!this.touchStartX||null!==this.touchEndX))return;let p,v;if("mousemove"!==e.type&&(p=[...e.changedTouches].find(e=>{var t;return e.identifier===(null===(t=this.touch1)||void 0===t?void 0:t.identifier)}),this.touchMove1=p||this.touchMove1,v=[...e.changedTouches].find(e=>{var t;return e.identifier===(null===(t=this.touch2)||void 0===t?void 0:t.identifier)}),this.touchMove2=v||this.touchMove2),"mousemove"===e.type||p){const a=("mousemove"===e.type?e.screenX:null!==(t=null==p?void 0:p.screenX)&&void 0!==t?t:0)-(null!==(o=this.touchStartX)&&void 0!==o?o:0);this.velocityX=a-(null!==(i=this.touchMoveX)&&void 0!==i?i:0),this.touchMoveX=a;const r=("mousemove"===e.type?e.screenY:null!==(n=null==p?void 0:p.screenY)&&void 0!==n?n:0)-(null!==(s=this.touchStartY)&&void 0!==s?s:0);this.velocityY=r-(null!==(h=this.touchMoveY)&&void 0!==h?h:0),this.touchMoveY=r;const d=Math.abs(this.touchMoveX),u=Math.abs(this.touchMoveY);this.swipingHorizontal=d>this.thresholdX,this.swipingVertical=u>this.thresholdY,this.swipingDirection=d>u?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(d,u)>this.opts.pressThreshold&&clearTimeout(null!==(l=this.longPressTimer)&&void 0!==l?l:void 0),this.fire("panmove",e)}"mousemove"!==e.type&&null!=this.touchMove1&&null!=this.touchMove2&&(this.newDistance=Math.sqrt(Math.pow(this.touchMove2.screenX-this.touchMove1.screenX,2)+Math.pow(this.touchMove2.screenY-this.touchMove1.screenY,2)),this.scale=this.newDistance/(null!==(a=this.originalDistance)&&void 0!==a?a:0),this.fire("pinch",e),this.newAngle=Math.atan2((null!==(r=this.touchMove2.screenY)&&void 0!==r?r:0)-(null!==(d=this.touchMove1.screenY)&&void 0!==d?d:0),(null!==(u=this.touchMove2.screenX)&&void 0!==u?u:0)-(null!==(c=this.touchMove1.screenX)&&void 0!==c?c:0))/(Math.PI/180),this.rotation=this.newAngle-(null!==(g=this.originalAngle)&&void 0!==g?g:0),this.fire("rotate",e))}onTouchEnd(e){var t,o,i,n,s,h,l,a,r,d;let u;if("mouseup"!==e.type&&(u=[...e.changedTouches].find(e=>{var t;return e.identifier===(null===(t=this.touch1)||void 0===t?void 0:t.identifier)}),[...e.touches].find(e=>{var t;return e.identifier===(null===(t=this.touch1)||void 0===t?void 0:t.identifier)})||(this.touch1=null,this.touchMove1=null),[...e.touches].find(e=>{var t;return e.identifier===(null===(t=this.touch2)||void 0===t?void 0:t.identifier)})||(this.touch2=null,this.touchMove2=null)),"mouseup"!==e.type||this.touchStartX&&null===this.touchEndX){if("mouseup"===e.type||u){this.touchEndX="mouseup"===e.type?e.screenX:null!==(t=null==u?void 0:u.screenX)&&void 0!==t?t:0,this.touchEndY="mouseup"===e.type?e.screenY:null!==(o=null==u?void 0:u.screenY)&&void 0!==o?o:0,this.fire("panend",e),clearTimeout(null!==(i=this.longPressTimer)&&void 0!==i?i:void 0);const c=this.touchEndX-(null!==(n=this.touchStartX)&&void 0!==n?n:0),g=Math.abs(c),p=this.touchEndY-(null!==(s=this.touchStartY)&&void 0!==s?s:0),v=Math.abs(p),w=Math.sqrt(Math.pow(c,2)+Math.pow(p,2)),y=Math.abs(w),m=v/g;g>this.thresholdX||v>this.thresholdY||this.opts.diagonalSwipes&&(y>this.thresholdX||y>this.thresholdY)?(this.swipedHorizontal=g>this.thresholdX||this.opts.diagonalSwipes&&y>this.thresholdX,this.swipedVertical=v>this.thresholdY||this.opts.diagonalSwipes&&y>this.thresholdY,(!this.opts.diagonalSwipes||m<Math.tan((45-this.opts.diagonalLimit)*Math.PI/180)||m>Math.tan((45+this.opts.diagonalLimit)*Math.PI/180))&&(g>=v&&(this.swipedVertical=!1),v>g&&(this.swipedHorizontal=!1)),this.swipedHorizontal&&(c<0?((null!==(h=this.velocityX)&&void 0!==h?h:0)<-this.opts.velocityThreshold||w<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",e):((null!==(l=this.velocityX)&&void 0!==l?l:0)>this.opts.velocityThreshold||w>this.disregardVelocityThresholdX)&&this.fire("swiperight",e)),this.swipedVertical&&(p<0?((null!==(a=this.velocityY)&&void 0!==a?a:0)<-this.opts.velocityThreshold||w<-this.disregardVelocityThresholdY)&&this.fire("swipeup",e):((null!==(r=this.velocityY)&&void 0!==r?r:0)>this.opts.velocityThreshold||w>this.disregardVelocityThresholdY)&&this.fire("swipedown",e))):g<this.opts.pressThreshold&&v<this.opts.pressThreshold&&(this.doubleTapWaiting?(this.doubleTapWaiting=!1,clearTimeout(null!==(d=this.doubleTapTimer)&&void 0!==d?d:void 0),this.fire("doubletap",e)):(this.doubleTapWaiting=!0,this.doubleTapTimer=setTimeout(()=>this.doubleTapWaiting=!1,this.opts.doubleTapTime),this.fire("tap",e)))}this.touch1||this.touch2||(this.fire("pinchend",e),this.fire("rotateend",e),this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null)}}}e.defaults={threshold:(e,t)=>Math.max(25,Math.floor(.15*("x"===e?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(e,t)=>Math.floor(.5*("x"===e?t.element.clientWidth:t.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:15,longPressTime:500,doubleTapTime:300,mouseSupport:!0};const t=e;let o,i=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){i={passive:!0}}}))}catch(e){}var n,s,h,l,a,r,d;const u={onload:({extensionAPI:e})=>{const i=["None","Back one day","Go to Today","Forward one day","Refresh","Undo","Redo","Toggle Right Sidebar","Toggle Left Sidebar","Open Command Palette","Keyboard Shortcut"],d={tabTitle:"Gesture Actions",settings:[{id:"ga-left",name:"Swipe Left",description:"Action to take on swipe left",action:{type:"select",items:i,onChange:e=>{c(e?.value??e?.target?.value??e)}}},{id:"ga-right",name:"Swipe Right",description:"Action to take on swipe right",action:{type:"select",items:i,onChange:e=>{g(e?.value??e?.target?.value??e)}}},{id:"ga-dt",name:"Double Tap",description:"Action to take on double tap",action:{type:"select",items:i,onChange:e=>{p(e?.value??e?.target?.value??e)}}},{id:"ga-lp",name:"Long Press",description:"Action to take on long press",action:{type:"select",items:i,onChange:e=>{v(e?.value??e?.target?.value??e)}}},{id:"ga-pinch",name:"Pinch",description:"Action to take on pinch",action:{type:"select",items:i,onChange:e=>{w(e?.value??e?.target?.value??e)}}},{id:"ga-rotate",name:"Rotate",description:"Action to take on rotate",action:{type:"select",items:i,onChange:e=>{y(e?.value??e?.target?.value??e)}}},{id:"ga-kb-1",name:"Keyboard Shortcut Key (a-z 0-9 ; , . / leftArrow upArrow rightArrow downArrow - =",action:{type:"input",placeholder:"keyboard shortcut key"}},{id:"ga-kb-2",name:"Keyboard Shortcut Modifier 1",action:{type:"select",items:["None","Ctrl/Meta","Shift","Alt/Opt"]}},{id:"ga-kb-3",name:"Keyboard Shortcut Modifier 2",action:{type:"select",items:["None","Ctrl/Meta","Shift","Alt/Opt"]}}]};e.settings.panel.create(d);const u=document.getElementsByClassName("roam-body");u[0]?(o=new t(u[0]),c(e.settings.get("ga-left")),g(e.settings.get("ga-right")),p(e.settings.get("ga-dt")),v(e.settings.get("ga-lp")),w(e.settings.get("ga-pinch")),y(e.settings.get("ga-rotate")),window.roamAlphaAPI?.platform&&(window.roamAlphaAPI.platform.isMobile||window.roamAlphaAPI.platform.isMobileApp||window.roamAlphaAPI.platform.isTouchDevice||window.roamAlphaAPI.platform.isIOS)&&(o.on("swipeleft",()=>{m(n,{extensionAPI:e})}),o.on("swiperight",()=>{m(s,{extensionAPI:e})}),o.on("doubletap",()=>{m(h,{extensionAPI:e})}),o.on("longpress",()=>{m(l,{extensionAPI:e})}),o.on("pinch",()=>{m(a,{extensionAPI:e})}),o.on("rotate",()=>{m(r,{extensionAPI:e})}))):console.warn("Gesture Actions: .roam-body not found; gestures not attached.")},onunload:()=>{o&&"function"==typeof o.destroy&&(o.destroy(),o=null)}};function c(e){n="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}function g(e){s="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}function p(e){h="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}function v(e){l="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}function w(e){a="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}function y(e){r="Forward one day"===e?"forward":"Go to Today"===e?"today":"Back one day"===e?"backward":"Refresh"===e?"refresh":"Undo"===e?"undo":"Redo"===e?"redo":"Toggle Right Sidebar"===e?"RSToggle":"Toggle Left Sidebar"===e?"LSToggle":"Open Command Palette"===e?"CP":"Keyboard Shortcut"===e?"KbS":null}async function m(e,{extensionAPI:t}){if("forward"===e||"backward"===e||"today"===e)await async function(e){const t=await window.roamAlphaAPI.ui.mainWindow.getOpenPageOrBlockUid();if(t){const e=`[:find (pull ?page [:node/title :block/string :block/uid {:block/children ...} ]) :where [?page :block/uid "${t}"]  ]`,o=await window.roamAlphaAPI.q(e);if(/\d{2}-\d{2}-\d{4}/.test(o[0][0].uid)){const e=o[0][0].uid.split("-"),t=String(parseInt(e[0],10)-1);d=new Date(e[2],t,e[1])}else d=new Date}else{const e=window.location.href;if(/^https:\/\/roamresearch.com\/.+\/(app|offline)\/\w+$/.test(e)){const e=new Date,t=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()).padStart(2,"0"),i=e.getFullYear();d=new Date(i,o,t)}}"backward"===e?d.setDate(d.getDate()-1):"forward"===e?d.setDate(d.getDate()+1):"today"===e&&(d=new Date);const o=(d.getMonth()+1).toString(),i=d.getDate().toString(),n=d.getFullYear().toString(),s=o.padStart(2,"0")+"-"+i.padStart(2,"0")+"-"+n,h=function(e){const t=e.split("-"),o=t[2],i=["January","February","March","April","May","June","July","August","September","October","November","December"][Number(t[0])-1],n=Number(t[1]);return`${i} ${n}${n>=4&&n<=20||n>=24&&n<=30?"th":["st","nd","rd"][n%10-1]}, ${o}`}(s);if((await window.roamAlphaAPI.q(`\n    [:find ?e\n        :where [?e :node/title "${h}"]]`)).length<1&&await window.roamAlphaAPI.createPage({page:{title:h,uid:s}}),null==window.roamAlphaAPI.data.pull("[:block/children]",[":block/uid",s])){const e=window.roamAlphaAPI.util.generateUID();await window.roamAlphaAPI.createBlock({location:{"parent-uid":s,order:0},block:{string:"",uid:e}})}window.roamAlphaAPI.ui.mainWindow.openBlock({block:{uid:s}})}(e);else if("refresh"===e)location.reload();else if("undo"===e)await window.roamAlphaAPI.data.undo();else if("redo"===e)await window.roamAlphaAPI.data.redo();else if("RSToggle"===e)document.querySelector("#roam-right-sidebar-content")?await window.roamAlphaAPI.ui.rightSidebar.close():await window.roamAlphaAPI.ui.rightSidebar.open();else if("LSToggle"===e)document.querySelector(".rm-open-left-sidebar-btn")?await window.roamAlphaAPI.ui.leftSidebar.open():await window.roamAlphaAPI.ui.leftSidebar.close();else if("CP"===e)try{const e="undefined"!=typeof navigator&&navigator.platform&&navigator.platform.toLowerCase().includes("mac"),t={key:"p",code:"KeyP",keyCode:80,which:80,bubbles:!0,cancelable:!0,shiftKey:!1,altKey:!1,ctrlKey:!e,metaKey:!!e},o=new KeyboardEvent("keydown",t),i=new KeyboardEvent("keyup",t);document.dispatchEvent(o),document.dispatchEvent(i)}catch(e){console.error("Gesture Actions: failed to dispatch Command Palette shortcut",e)}else if("KbS"===e){let e,o,i,n,s,h=!1,l=!1,a=!1,r=!1;t.settings.get("ga-kb-1")&&(e=t.settings.get("ga-kb-1")),"None"!==t.settings.get("ga-kb-2")&&(o=t.settings.get("ga-kb-2")),"None"!==t.settings.get("ga-kb-3")&&(i=t.settings.get("ga-kb-3")),"0"===e?(n="Digit0",s=48):"1"===e?(n="Digit1",s=49):"2"===e?(n="Digit2",s=50):"3"===e?(n="Digit3",s=51):"4"===e?(n="Digit4",s=52):"5"===e?(n="Digit5",s=53):"6"===e?(n="Digit6",s=54):"7"===e?(n="Digit7",s=55):"8"===e?(n="Digit8",s=56):"9"===e?(n="Digit9",s=57):"a"===e?(n="KeyA",s=65):"b"===e?(n="KeyB",s=66):"c"===e?(n="KeyC",s=67):"d"===e?(n="KeyD",s=68):"e"===e?(n="KeyE",s=69):"f"===e?(n="KeyF",s=70):"g"===e?(n="KeyG",s=71):"h"===e?(n="KeyH",s=72):"i"===e?(n="KeyI",s=73):"j"===e?(n="KeyJ",s=74):"k"===e?(n="KeyK",s=75):"l"===e?(n="KeyL",s=76):"m"===e?(n="KeyM",s=77):"n"===e?(n="KeyN",s=78):"o"===e?(n="KeyO",s=79):"p"===e?(n="KeyP",s=80):"q"===e?(n="KeyQ",s=81):"r"===e?(n="KeyR",s=82):"s"===e?(n="KeyS",s=83):"t"===e?(n="KeyT",s=84):"u"===e?(n="KeyU",s=85):"v"===e?(n="KeyV",s=86):"w"===e?(n="KeyW",s=87):"x"===e?(n="KeyX",s=88):"y"===e?(n="KeyY",s=89):"z"===e?(n="KeyZ",s=90):"leftArrow"===e?(n="ArrowLeft",s=37):"upArrow"===e?(n="ArrowUp",s=38):"rightArrow"===e?(n="ArrowRight",s=39):"downArrow"===e?(n="ArrowDown",s=40):";"===e?(n="Semicolon",s=59):","===e?(n="Comma",s=44):"."===e?(n="Period",s=46):"/"===e?(n="Slash",s=191):"-"===e?(n="Minus",s=189):"="===e&&(n="Equal",s=187),"Ctrl/Meta"===o?(a=!0,l=!0):"Shift"===o?r=!0:"Alt/Opt"===o&&(h=!0),"Ctrl/Meta"===i?(a=!0,l=!0):"Shift"===i?r=!0:"Alt/Opt"===i&&(h=!0),window.roamAlphaAPI.platform.isIOS?(window.dispatchEvent(new KeyboardEvent("keydown",{key:e,keyCode:s,code:n,which:s,shiftKey:r,ctrlKey:a,altKey:h})),window.dispatchEvent(new KeyboardEvent("keyup",{key:e,keyCode:s,code:n,which:s,shiftKey:r,metaKey:l,altKey:h}))):(window.dispatchEvent(new KeyboardEvent("keydown",{key:e,keyCode:s,code:n,which:s,shiftKey:r,ctrlKey:a,altKey:h})),window.dispatchEvent(new KeyboardEvent("keyup",{key:e,keyCode:s,code:n,which:s,shiftKey:r,ctrlKey:a,altKey:h})))}}export{u as default};